# -*- coding: utf-8 -*-
"""
Prompt templates for all tool tree related operations

"""

# Prompt template for clustering tool nodes
CLUSTER_NODES_PROMPT = """
请将下面相关的工具和工具类中进行合并，每个合并后的工具类最多包含{max_items}个子节点，每个合并后的工具类，必须要清晰的反应工具类包含的子类和工具的特点或范围。你需要合并的节点类如下:

{nodes_descriptions}

请用json格式给出回答
"""

CLUSTER_NODES_PROMPT_EN = """
Please merge the related tools and tool classes below.
Each merged tool class should contain at most {max_items} child nodes.
 Each merged tool class must clearly reflect the characteristics
or scope of the subclasses and tools it contains.
 The node classes you need to merge are as follows:

{nodes_descriptions}

Please provide your answer in JSON format.
"""

CLUSTER_NODES_SYSTEM_PROMPT = """你是一个工具处理大师，请将用户提供的工具和工具类合并为更大的工具类。
如果一个工具或工具类无法与其他合并，则不需要输出。
每个合并类最多包含{max_items}个子节点，合并后的工具类需要一个name和details并记录children，其中details是节点的细节描述。
你需要清晰、完整的指出这个工具类的功能范围和功能涉及，这个描述应当尽可能的贴合子节点的特性，不要过于广义。
返回json信息对应的schema为<schema>{json_schema}</schema>
"""

CLUSTER_NODES_SYSTEM_PROMPT_EN = """You are a tool processing expert.
Please merge the tools and tool classes provided by
the user into larger tool classes.
If a tool or tool class cannot be merged with others,
it does not need to be output.
Each merged class should contain at most {max_items} child nodes.
The merged tool class needs a name and details and records children,
where details is the detailed description of the node.
You need to clearly and completely indicate the functional scope and
functionality of this tool class.
This description should match the characteristics of
the child nodes as closely as possible and should not be too general.
The schema for the returned JSON information is <schema>{json_schema}</schema>
"""

# Prompt template for node classification batch processing
NODE_CLASSIFICATION_PROMPT = """
请你对用户的各种工具进行分类归属，把具有相似、相关功能的工具归属到当前树上最合适的工具类别。
注意: 如果没有合适的分类，可以直接合并在root根节点下，不要主动新加节点。
请根据以下树结构和节点信息，判断该节点应该插入到树的哪个非叶节点下：

#当前树结构：
{tree_structure}

#你需要处理的节点信息：
{node_data}

请用正确的json格式给出回答
"""

NODE_CLASSIFICATION_PROMPT_EN = """
Please classify and categorize the user's various tools,
assigning tools with similar and related functions to
the most appropriate tool categories in the current tree.
Note: If there is no suitable classification,
you can directly merge under the root node. Do not actively add new nodes.
Please judge which non-leaf node in the tree this node should be
inserted under based on the following tree structure and node information:

#Current tree structure:
{tree_structure}

#Node information you need to process:
{node_data}

Please provide your answer in correct JSON format.
"""

NODE_CLASSIFICATION_SYSTEM_PROMPT = """
你是一个工具管理大师，请依据下面的json schema对用户的工具进行归类，
json schema形式为:<schema>{json_schema}</schema>
"""

NODE_CLASSIFICATION_SYSTEM_PROMPT_EN = """
You are a tool management expert.
Please classify user tools according to the JSON schema below.
The JSON schema format is: <schema>{json_schema}</schema>
"""

# Prompt template for searches decisions
SEARCH_DECISION_PROMPT = """
基于用户的需求，在当前工具树中找到最合适的工具或工具类。

用户需求: {query}

当前位置: {path}

可见的工具树结构:
{subtree}

请根据用户需求，选择以下操作之一:
1. select_tool: 如果你在当前节点下找到了完全匹配用户需求的具体工具，选择该工具
2. explore_directory: 如果需要进一步探索某个子目录来找到更相关的工具
3. back: 如果当前路径不合适，需要返回上级
4. end: 如果已找到足够相关的工具或无法找到更匹配的工具，结束搜索

提供详细理由解释你的选择。
"""

SEARCH_DECISION_PROMPT_EN = """
Based on the user's needs, find the most appropriate tool
or tool class in the current tool tree.

User requirement: {query}

Current location: {path}

Visible tool tree structure:
{subtree}

Please choose one of the following actions based on user requirements:
1. select_tool: If you find a specific tool that completely matches
the user's needs under the current node, select that tool
2. explore_directory:
If you need to further explore a subdirectory to find more relevant tools
3. back: If the current path is inappropriate,
you need to return to the parent level
4. end: If you have found sufficiently relevant tools or
cannot find more matching tools, end the searches

Provide detailed reasons to explain your choice.
"""

SEARCH_DECISION_SYSTEM_PROMPT = """
你是一个精确的工具搜索专家，根据用户需求在工具树中准确定位最合适的工具。
依据下面的json schema对用户的工具进行归类，json schema形式为:<schema>{json_schema}</schema>
"""

SEARCH_DECISION_SYSTEM_PROMPT_EN = """
You are a precise tool searches expert who accurately locates
the most appropriate tools in the tool tree based on user needs.
Classify user tools according to the JSON schema below,
the JSON schema format is: <schema>{json_schema}</schema>
"""

# Prompt template for multi-tool searches decisions
MULTI_TOOL_SEARCH_PROMPT = """
基于用户的需求，在当前工具树中找到所有相关的工具。请分析用户需求的复杂性，考虑是否存在多个相关的工具或工具类。

用户需求: {query}

当前位置: {path}

可见的工具树结构:
{subtree}

请根据用户需求，选择以下操作之一:
1. select_nodes: 选择一个或多个相关的节点(可以是工具或目录)，工具将直接添加到结果中，目录将继续搜索
2. back: 如果当前路径不合适，需要返回上级
3. end: 如果已找到足够相关的工具或无法找到更匹配的工具，结束搜索

对于选择的每个节点，请：
- 解释为什么选择这个节点
- 考虑工具间的协同作用或功能相似的工具类

提供详细理由解释你的整体决策。
"""

MULTI_TOOL_SEARCH_PROMPT_EN = """
Based on the user's needs, find all relevant tools in the current tool tree.
Please analyze the complexity of user requirements and
 consider whether there are multiple relevant tools or tool classes.

User requirement: {query}

Current location: {path}

Visible tool tree structure:
{subtree}

Please choose one of the following actions based on user requirements:
1. select_nodes: Select one or more related nodes
(can be tools or directories),
tools will be directly added to the results,
directories will continue to be searched
2. back: If the current path is inappropriate,
you need to return to the parent level
3. end: If you have found sufficiently relevant tools
or cannot find more matching tools, end the searches

For each selected node, please:
- Explain why you chose this node
- Consider synergies between tools or functionally similar tool classes

Provide detailed reasons to explain your overall decision.
"""

MULTI_TOOL_SEARCH_SYSTEM_PROMPT = """
你是一个智能的多工具搜索专家，能够理解复杂的用户需求并找到最想关的工具列表：
1. 尽量只选择一个节点
2. 在多个工具或多个工具类都有可能时返回多个节点

依据下面的json schema对用户的工具进行归类，json schema形式为:<schema>{json_schema}</schema>
"""

MULTI_TOOL_SEARCH_SYSTEM_PROMPT_EN = (
    ""
    "You are an intelligent multi-tool searches expert who can "
    "understand complex user needs and find the most relevant tool list:"
)
"1. Try to select only one node"
"2. Return multiple nodes when multiple tools or multiple "
"tool classes are possible"

"Classify user tools according to the JSON schema below,"
"the JSON schema format is: <schema>{json_schema}</schema>"

# Prompt template for directory selection
DIRECTORY_SELECTION_PROMPT = """
基于用户的需求，选择最相关的子目录继续搜索。

用户需求: {query}

当前位置: {path}

可见的目录结构:
{subtree}

请选择与用户需求最相关的子目录，并提供理由。
"""

DIRECTORY_SELECTION_PROMPT_EN = """
Based on the user's needs,
select the most relevant subdirectory to continue searching.

User requirement: {query}

Current location: {path}

Visible directory structure:
{subtree}

Please select the subdirectory most relevant to the
user's needs and provide reasons.
"""

DIRECTORY_SELECTION_SYSTEM_PROMPT = """
你是一个精确的工具搜索专家，帮助用户在工具树中找到最合适的工具类别。
依据下面的json schema对用户的工具进行归类，json schema形式为:<schema>{json_schema}</schema>
"""

DIRECTORY_SELECTION_SYSTEM_PROMPT_EN = """
You are a precise tool searches expert who helps users
find the most appropriate tool categories in the tool tree.
Classify user tools according to the JSON schema below,
the JSON schema format is: <schema>{json_schema}</schema>
"""

# Prompt template for tree merge decisions
MERGE_DECISION_PROMPT = """
请分析以下工具树节点结构，并决定如何将新节点合并到已满的目标节点。

目标节点结构:
{target_structure}

需要合并的源节点:
{source_description}

请提供一种最优合并策略，可选项:
1. merge_with_child: 将源节点合并到现有的某个子节点中
2. create_new_group: 创建一个新的分组，将源节点和部分相关的现有子节点组织到一起
3. restructure: 建议重组整个目标节点的结构

每个节点最多可包含 {max_items} 个子节点。
"""

MERGE_DECISION_PROMPT_EN = """
Please analyze the following tool tree node structure
and decide how to merge new nodes into the full target node.

Target node structure:
{target_structure}

Source node to be merged:
{source_description}

Please provide an optimal merge strategy with the following options:
1. merge_with_child: Merge the source node into an existing child node
2. create_new_group: Create a new group and organize
the source node and some related existing child nodes together
3. restructure: Suggest restructuring the entire target node structure

Each node can contain at most {max_items} child nodes.
"""

MERGE_DECISION_SYSTEM_PROMPT = """
你是一个专业的工具树结构专家，精通如何组织和归类不同的工具节点。
请根据以下json schema提供决策：<schema>{json_schema}</schema>
"""

MERGE_DECISION_SYSTEM_PROMPT_EN = """
You are a professional tool tree structure expert who is proficient
in organizing and categorizing different tool nodes.
Please provide decisions according to the following JSON schema:
<schema>{json_schema}</schema>
"""
